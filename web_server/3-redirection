#!/usr/bin/env bash
# Configures Nginx so /redirect_me returns a 301 redirect to a target URL

apt-get update -y
apt-get install -y nginx

# Recreate the default index page (like in 1-install_nginx_web_server)
echo "Hello World!" > /var/www/html/index.html

CONF="/etc/nginx/sites-available/default"

# Insert a location block for /redirect_me only once
if ! grep -q "location /redirect_me" "$CONF"; then
    sed -i 's|server_name _;|server_name _;\n\n\tlocation /redirect_me {\n\t\treturn 301 https://www.youtube.com/watch?v=QH2-TGUlwu4;\n\t}|' "$CONF"
fi

service nginx restart
